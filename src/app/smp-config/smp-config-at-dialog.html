<div class="smpconfig-dialog">
  <h1 mat-dialog-title>选择需要发布分享的模板</h1>
  <div mat-dialog-content>
    <mat-form-field class="at-search-form-field" appearance="fill">
      <mat-label>请至少输入2个字来搜索模板</mat-label>
  <!--
      <input matInput type="text" [(ngModel)]="atNameForSearch" (change)="onSearchTxtChange($event)">
      <input matInput type="text" [(ngModel)]="atNameForSearch" (keyup)="onSearchTxtChange($event.target?.value?)" >
  -->
      <input matInput type="text" [(ngModel)]="atNameForSearch" (keyup)="onSearchTxtChange($event)" >
      <button *ngIf="atNameForSearch" matSuffix mat-icon-button aria-label="Clear" (click)="atNameForSearch=''">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>


  <!--
  <mat-list>
    <div mat-subheader>Folders</div>
    <mat-list-item *ngFor="let folder of folders">
      <mat-icon mat-list-icon>folder</mat-icon>
      <div mat-line>{{folder.name}}</div>
      <div mat-line> {{folder.updated | date}} </div>
    </mat-list-item>
    <mat-divider></mat-divider>
    <div mat-subheader>Notes</div>
    <mat-list-item *ngFor="let note of notes">
      <mat-icon mat-list-icon>note</mat-icon>
      <div mat-line>{{note.name}}</div>
      <div mat-line> {{note.updated | date}} </div>
    </mat-list-item>
  </mat-list>


  <mat-selection-list #shoes [multiple]="false">
    <mat-list-option *ngFor="let shoe of typesOfShoes" [value]="shoe">
      {{shoe}}
    </mat-list-option>
  </mat-selection-list>

  <p>
    Option selected: {{shoes.selectedOptions.selected[0]?.value}}
  </p>
    <button mat-button (click)="printEnv()">test</button>
  -->


  <mat-tab-group
    animationDuration="2000ms"
    class="at-list-for-selection"
    [selectedIndex]="selectedTabIndex"
    (selectedIndexChange)="onSelectedTabIndexChange($event)"
  >
    <mat-tab label="最近的模板" >
      <table mat-table [dataSource]="dataSourceRecent" matSort>
        <!-- Position Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> 标题 </th>
          <td mat-cell *matCellDef="let element"> {{element.title}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> 名称 </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <!-- Weight Column -->
        <ng-container matColumnDef="updated">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> 修改时间 </th>
          <td mat-cell *matCellDef="let element"> {{element.updated}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row
          (click)="onATSelectionChange(row)"
          [class.row-is-selected]="data.authoringTemplate === row"
          *matRowDef="let row; columns: displayedColumns;"
        ></tr>
      </table>
    </mat-tab>
    <mat-tab label="搜索结果" >
      <table mat-table [dataSource]="dataSourceSearch" matSort>
        <!-- Position Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> 标题 </th>
          <td mat-cell *matCellDef="let element"> {{element.title}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> 名称 </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <!-- Weight Column -->
        <ng-container matColumnDef="updated">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> 修改时间 </th>
          <td mat-cell *matCellDef="let element"> {{element.updated}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row
          (click)="onATSelectionChange(row)"
          [class.row-is-selected]="data.authoringTemplate === row"
          *matRowDef="let row; columns: displayedColumns;"
        ></tr>
      </table>
    </mat-tab>
  </mat-tab-group>


<!--
  <mat-selection-list class="at-list-for-selection" #ATs [multiple]="false" [(ngModel)]="data.authoringTemplate" (selectionChange)="onATSelectionChange()" required>
    <div mat-subheader>searchResult</div>
    <mat-list-option class="search-at-list" *ngFor="let item of searchedItems" [value]="item">
      {{item.title}} - {{item.name}} - {{item.updated}}
    </mat-list-option>
    <div mat-subheader>Recent</div>
    <mat-list-option class="recent-at-list" *ngFor="let item of recentItems" [value]="item">
      {{item.title}} - {{item.name}} - {{item.updated}}
    </mat-list-option>
  </mat-selection-list>
    <p>
      Select AuthoringTemplate: {{ATs.selectedOptions.selected[0]?.value?.title}}
      Select AuthoringTemplate id: {{ATs.selectedOptions.selected[0]?.value?.itemId}}
    </p>
-->

  <div class="field-mapping" *ngIf="currentElementsHost && currentElementsHost === data.authoringTemplate?.itemId">

    <div class="map-AT-field map-at-field" >
      <h4>从模板中选择需要发布分享的域</h4>
      <mat-form-field appearance="fill" class="map-AT-title">
        <mat-label>映射模板的域到社交媒体的标题:</mat-label>
        <mat-select [formControl]="currentATControl" [(ngModel)]="data.titleField">
          <mat-option>-- None --</mat-option>
          <mat-optgroup *ngFor="let group of currentATFields" [label]="group.name" [disabled]="group.disabled">
            <mat-option *ngFor="let item of group.items" [value]="item.value">
              {{item.viewValue}}
            </mat-option>
          </mat-optgroup>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill" class="map-AT-content">
        <mat-label>映射模板的域到社交媒体的内容:</mat-label>
        <mat-select [formControl]="currentATControl" [(ngModel)]="data.contentField">
          <mat-option>-- None --</mat-option>
          <mat-optgroup *ngFor="let group of currentATFields" [label]="group.name" [disabled]="group.disabled">
            <mat-option *ngFor="let item of group.items" [value]="item.value">
              {{item.viewValue}}
            </mat-option>
          </mat-optgroup>
        </mat-select>
      </mat-form-field>
    </div>
    <!--
    <h4>mat-select</h4>
    <mat-form-field appearance="fill">
      <mat-label>映射模板的域到社交媒体的标题:</mat-label>
      <mat-select [formControl]="pokemonControl">
        <mat-option>-- None --</mat-option>
        <mat-optgroup *ngFor="let group of pokemonGroups" [label]="group.name" [disabled]="group.disabled">
          <mat-option *ngFor="let pokemon of group.pokemon" [value]="pokemon.value">
            {{pokemon.viewValue}}
          </mat-option>
        </mat-optgroup>
      </mat-select>
    </mat-form-field>
    -->

  </div>
  <div mat-dialog-actions class="smpconfig-dialog-actions">
    <button mat-button [mat-dialog-close]="data" mat-raised-button color="primary" [disabled]="!data.authoringTemplate" cdkFocusInitial>添加</button>
    <button mat-button (click)="onNoClick()">取消</button>
  </div>

</div>
