<home activeId="smpshare">
<ng-template #togglerContentTpl>
  <div class="smpshare-container component-container">
    <h1 class="component-title">社交媒体手动分享</h1>

    <!--
                <content-preview
                  [previewItems]="previewItems"
                  *ngIf="previewItems"
                  >
                </content-preview>
    -->
    <!--
    -->
    <button mat-raised-button color="primary" (click)="previewContents(testData.previewItems, testData.atMap, testData.atDetail)"
      *ngIf="isDebug"
      >Preview</button>

    <div class="share-stepper" *ngIf="effectivePreference?.atMapsDetail">
      <mat-stepper linear #stepper [orientation]="(stepperOrientation | async)!" >
        <mat-step [stepControl]="formAT" label="选择编辑模板" editable="true" linear="true">
          <form [formGroup]="formAT">
            <ng-template matStepLabel>{{ isProMode ? '选择编辑模板' : '选择模式'}}</ng-template>
            <div class="content-body" >
              <h3 class="default-at-warn" *ngIf="!effectivePreference?.defaultAT">
                <span class="highlight-text">默认模板</span> 
                还没有设置, 请前往
                <span class="highlight-text">偏好设置</span> 设置.<br>
                否则, 只能在
                <span class="highlight-text">专家模式</span> 
                下分享.
              </h3>
              <mat-slide-toggle labelPosition="before" [(ngModel)]="isProMode" [ngModelOptions]="{standalone: true}" [disabled]="!effectivePreference?.defaultAT">专家模式</mat-slide-toggle>

              <div class="at-select-parent"
                [class.display-none]="!isProMode"
                >
                <at-select (selectEvent)="onATSelect($event)" [availableATs]="availableATs"></at-select>
              </div>

              <div class="step-action">
                <!--
                <button mat-raised-button color="link" matStepperPrevious>上一步</button>
                -->
                <button #ModNextBtn mat-raised-button color="accent" (click)="onIsProModeChange(); stepper.next();" [disabled]="isProMode && formAT.invalid" matStepperNext>下一步</button>
              </div>
            </div>
          </form>
        </mat-step>

        <mat-step [stepControl]="formContent" label="选择要发布的内容" editable="true" linear="true">
          <form [formGroup]="formContent">
            <ng-template matStepLabel>选择要发布的内容</ng-template>
                  
            <div class="content-body" [class.hide]="formAT.value.authoringTemplate?.itemId !== fetchedATId"
                 *ngIf="formAT.value.authoringTemplate"
              >
              <div class="map-parent">
                <content-select
                  [atId]="formAT.value.authoringTemplate?.itemId"
                  [excludedItems]="getExcludedItems()"
                  [isNeedToAdd]="true"
                  (previewEvent)="onChildPreview($event)"
                  [(fetchedATId)]="fetchedATId"
                  >
                </content-select>
              </div>

              <div class="step-action">
                <button mat-raised-button color="link" matStepperPrevious>上一步/添加更多内容</button>
              </div>
            </div>


          </form>
        </mat-step>
        <ng-template matStepperIcon="edit">
          <mat-icon>done</mat-icon>
        </ng-template>

      </mat-stepper>
    </div>


    <mat-divider></mat-divider>

    <h3 class="to-share-list">待分享列表{{ formAPP.value.appconfig? ' - ' + getI18n(formAPP.value.appconfig?.smpType) : ''}}</h3>

    <form [formGroup]="formData" class="content-list-form">

      <div class="smpshare-at-actions" >
        <!--
        <button mat-raised-button color="accent" (click)="previewContents(selection.selected)" [disabled]="!selection.selected.length" >预览</button>
        -->
        <button mat-raised-button (click)="deleteSelection()" *ngIf="selection.selected.length" >从列表中删除选中的模板</button>
      </div>
      <!--
      <div class="mat-elevation-z8 at-list" *ngIf="shareList.length > 0">
      -->
      <div class="mat-elevation-z8 at-list">
        <table mat-table [dataSource]="dataSource" matSort #sortShare="matSort">
          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox (change)="$event ? masterToggle() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                            [aria-label]="checkboxLabel()">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(row) : null"
                            [checked]="selection.isSelected(row)"
                            [aria-label]="checkboxLabel(row)">
              </mat-checkbox>
            </td>
          </ng-container>

          <ng-template [ngIf]="isProMode">
            <!-- title Column -->
            <ng-container matColumnDef="atName">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> 模板名称 </th>
              <td mat-cell *matCellDef="let element" title="{{element.atDetail.name}}"> {{element.atDetail.name}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="atTitle">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> 模板标题 </th>
              <td mat-cell *matCellDef="let element" title="{{element.atDetail.title}}"> {{element.atDetail.title}} </td>
            </ng-container>

          </ng-template>

          <!-- atConfig Column -->
          <ng-container matColumnDef="atConfigName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 配置名称 </th>
            <td mat-cell *matCellDef="let element" title="{{element.atConfig.atConfigName}}">{{element.atConfig.atConfigName}}</td>
          </ng-container>

          <!-- lastModified Column -->
          <ng-container matColumnDef="contentName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 内容名称 </th>
            <td mat-cell *matCellDef="let element" title="{{element.item.name}}"> {{element.item.name}} </td>
          </ng-container>

          <!-- mapping Column -->
          <ng-container matColumnDef="contentTitle">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 内容标题 </th>
            <td mat-cell *matCellDef="let element" title="{{element.item.title}}"> {{element.item.title}}</td>
          </ng-container>

          <ng-container matColumnDef="contentUpdated">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 内容修改时间 </th>
            <td mat-cell *matCellDef="let element" title="{{element.item.updated}}"> {{element.item.updated}}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="isProMode ? displayedColumnsATResult : displayedColumnsResult"></tr>
          <tr mat-row *matRowDef="let row; columns: isProMode ? displayedColumnsATResult : displayedColumnsResult;"></tr>
        </table>

        <mat-paginator #paginatorShare [length]="this.dataSource.data.length" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
      </div>

    <div class="smpshare-actions action-group">
      <button mat-raised-button color="primary" (click)="onSubmit()">提交</button>
      <button mat-button (click)="onCancel();" routerLink="/" >返回</button>
  <!--
  -->
      <button mat-button (click)="printEnv()" *ngIf="isDebug">test</button>
    </div>
    </form>
  </div>
</ng-template>
</home>

