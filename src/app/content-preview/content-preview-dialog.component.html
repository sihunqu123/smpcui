<div class="preview-dailog">
  <div class="preview-dialog-header">
    <h2 mat-dialog-title class="mat-h2">选择配置来预览{{ isNeedToAdd ? '发布分享' : ''}}</h2>
    <mat-form-field appearance="fill" class="map-AT-content" hideRequiredMarker="false">
      <mat-label>预览模式:</mat-label>
      <mat-select
        [(ngModel)]="previewMode" [ngModelOptions]="{standalone: true}"
        (selectionChange)="changePreviewMOde($event)" required>
        <mat-optgroup *ngFor="let group of previewOptions" [label]="group.name" [disabled]="group.disabled">
          <mat-option *ngFor="let item of group.items" [value]="item.value">
            {{item.viewValue}}
          </mat-option>
        </mat-optgroup>
      </mat-select>
    </mat-form-field>
  </div>
  <mat-dialog-content class="preview-dailog-content">

    <div class="config-column">
    </div>
    <div class="preview-column">
      <mat-tab-group [selectedIndex]="tmpData.tabIndex" (selectedIndexChange)="tmpData.tabIndex = $event">
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">edit</mat-icon>
            选择映射
          </ng-template>
          <div class="config-parent"
            >
            <atConfigs [atMap]="atMap" (selectATConfig)="setATConfig($event)" [(openStats)]="openStats"></atConfigs>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">remove_red_eye</mat-icon>
            预览-{{ this.selectedATConfig?.atConfigName }}
          </ng-template>
          <div class="preview-tab-content">
            <mat-tab-group>
              <ng-container *ngFor="let item of this.selectedATConfig?.Facebook; let i = index;">
                <mat-tab *ngIf="item.isShare">
                  <ng-template mat-tab-label>
                    <!--
                    <mat-icon class="example-tab-icon">edit</mat-icon>
                    -->
                    <img class="tab-icon" src="https://findicons.com/files/icons/1181/flurry_extras_2/128/facebook.png" />
                    脸书-{{i + 1}} 
                  </ng-template>
                  <div class="config-parent"
                    >
                    <preview-facebook
                      [previewItems]="previewItems"
                      [shareConfig]="item"
                      [(previewOption)]="previewOption"
                      *ngIf="previewItems"
                      >
                    </preview-facebook>
                  </div>
                </mat-tab>
              </ng-container>

              <ng-container *ngFor="let item of this.selectedATConfig?.WeiBo; let i = index;">
                <mat-tab *ngIf="item.isShare">
                  <ng-template mat-tab-label>
                    <!--
                    <mat-icon class="example-tab-icon">edit</mat-icon>
                    -->
                    <img class="tab-icon" src="https://weibo.com/favicon.ico" />
                    微博-{{i + 1}}
                  </ng-template>
                  <div class="config-parent"
                    >
                    <preview-weibo
                      [previewItems]="previewItems"
                      [shareConfig]="item"
                      [(previewOption)]="previewOption"
                      *ngIf="previewItems"
                      >
                    </preview-weibo>
                  </div>
                </mat-tab>
              </ng-container>

              <ng-container *ngFor="let item of this.selectedATConfig?.WeChat; let i = index;">
                <mat-tab *ngIf="item.isShare">
                  <ng-template mat-tab-label>
                    <!--
                    <mat-icon class="example-tab-icon">edit</mat-icon>
                    -->
                    <img class="tab-icon" src="https://favicon.yandex.net/favicon/v2/wechat.com" />
                    微信公众号-{{i + 1}} 
                  </ng-template>
                  <div class="config-parent"
                    >
                    <preview-wechat
                      [previewItems]="previewItems"
                      [shareConfig]="item"
                      [(previewOption)]="previewOption"
                      *ngIf="previewItems"
                      >
                    </preview-wechat>
                  </div>
                </mat-tab>
              </ng-container>

              <ng-container *ngFor="let item of this.selectedATConfig?.WeCom; let i = index;">
                <mat-tab *ngIf="item.isShare">
                  <ng-template mat-tab-label>
                    <!--
                    <mat-icon class="example-tab-icon">edit</mat-icon>
                     for more icon: https://www.freeiconspng.com/images/wechat-icon
                    -->
                    <img class="tab-icon" src="https://www.freeiconspng.com/thumbs/wechat-icon/wechat-icon-16.png" />
                    微信群-{{i + 1}} 
                  </ng-template>
                  <div class="config-parent"
                    >
                    <preview-wecom
                      [previewItems]="previewItems"
                      [shareConfig]="item"
                      [(previewOption)]="previewOption"
                      *ngIf="previewItems"
                      >
                    </preview-wecom>
                  </div>
                </mat-tab>
              </ng-container>
            </mat-tab-group>
            <!--
            <content-preview
              [previewItems]="previewItems"
              [atConfig]="selectedATConfig"
              [(previewOption)]="previewOption"
              *ngIf="previewItems"
              >
            </content-preview>
            -->
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>

    <!--
    <content-preview
      [previewItems]="previewItems"
      [(previewOption)]="previewOption"
      *ngIf="previewItems"
      >
    </content-preview>
    -->
  </mat-dialog-content>
  <mat-dialog-actions align="end" class="preview-actions action-group">
    <!--
    <button mat-button mat-dialog-close>Cancel</button>
    -->
    <button mat-button (click)="printEnv()" *ngIf="isDebug">test</button>

    <button mat-raised-button color="basic" (click)="approve()" [disabled]="!selectedATConfig"
      *ngIf="previewActionMode === 'review'"
      cdkFocusInitial>同意但不分享</button>

    <button mat-raised-button color="accent" (click)="acceptAndShare()" [disabled]="!selectedATConfig"
      *ngIf="previewActionMode === 'review'"
      cdkFocusInitial>同意并用选择的配置来分享这些文章</button>

    <button mat-raised-button color="accent" (click)="share()" [disabled]="!selectedATConfig"
      *ngIf="previewActionMode === 'review'"
      cdkFocusInitial>分享这些文章</button>

    <!--
    <button mat-raised-button color="warn" (click)="reject()" [disabled]="!selectedATConfig"
      *ngIf="previewActionMode === 'review'"
      cdkFocusInitial>拒绝</button>
    -->

    <button mat-raised-button color="accent" (click)="shareWithATConfig()" [disabled]="!selectedATConfig"
      *ngIf="isNeedToAdd && previewActionMode === 'normal'"
      cdkFocusInitial>用选择的配置来分享这些文章</button>

    <button mat-raised-button color="basic" [mat-dialog-close]="true" cdkFocusInitial>关闭</button>
    <button mat-raised-button color="primary" (click)="changeIndex(false)"
      [disabled]="previewOption.currentIndex <= 0"
      *ngIf="!previewOption.isList"
      >上一条</button>
    <button mat-raised-button color="primary" (click)="changeIndex(true)"
      [disabled]="previewOption.currentIndex > previewItems.length - 2"
      *ngIf="!previewOption.isList"
      >下一条</button>
  </mat-dialog-actions>
</div>
